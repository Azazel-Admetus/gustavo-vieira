<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/SolumChat.css">
    <title>SolumChat</title>
</head>
<body>
    <header>
        <img src="../image/ProjetoCaelum-semBg.png" alt="Logo oficial do projeto caelum" id="logoSolumChat">
        <button id="btnLimpar">Limpar</button>
    </header>
    <main>
        <header>
            <h1 class="titulo" id="tituloDinamico">Seja-bem vindo ao SolumChat. <br>Tire suas dúvidas sobre física</h1>
        </header>
        <section id="chatMessagens"></section>
    </main>
    <footer>
        <form id="formChat">
            <input type="text" id="inputMensagem" placeholder="Diga sua dúvida...">
            <button type="submit">Enviar</button>
        </form>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
    <script>
        const chatMensagens = document.getElementById("chatMessagens");
        const formChat = document.getElementById("formChat");
        const inputMensagem = document.getElementById("inputMensagem");
        const btnLimpar = document.getElementById("btnLimpar");
        const tituloDinamico = document.getElementById("tituloDinamico");

        let todosOsDados = [];
        let fuse;

        // Carrega todos os arquivos JSON de temas
        const temas = ["mecanica", "termologia", "ondulatoria", "optica", "eletromagnetismo", "biografia"];

        async function carregarTodosOsTemas() {
            for (const tema of temas) {
                const response = await fetch(`../js/JSON/${tema}.json`);
                const dados = await response.json();
                todosOsDados.push(...dados.map(d => ({ ...d, tema })));
            }

            fuse = new Fuse(todosOsDados, {
                keys: ['perguntas'],
                threshold: 0.4
            });
        }

        carregarTodosOsTemas();

        // Função para adicionar mensagens
        function adicionarMensagem(texto, tipo) {
            const div = document.createElement("div");
            div.classList.add("mensagem", tipo);

            const img = document.createElement("img");
            img.classList.add("avatar");
            img.src = tipo === "solum" ? "../image/AvatarSolum.png" : "../image/AvatarUser.png";
            img.alt = tipo === "solum" ? "Avatar Solum" : "Avatar Usuário";

            const p = document.createElement("p");
            p.classList.add("texto");
            p.textContent = texto;

            div.appendChild(img);
            div.appendChild(p);
            chatMensagens.appendChild(div);

            chatMensagens.scrollTop = chatMensagens.scrollHeight;
        }

        // Função para buscar resposta em todos os temas
        function buscarResposta(userQuest) {
            if (!fuse) return "Ainda estou carregando meu conhecimento...";

            const resultado = fuse.search(userQuest);
            if (resultado.length > 0) {
                const melhor = resultado[0].item;
                return `[${melhor.tema.toUpperCase()}]: ${melhor.resposta}`;
            }
            return "Desculpe, não consegui entender sua pergunta. Tente reformular.";
        }

        // Falar com voz
        function falar(texto) {
            const msg = new SpeechSynthesisUtterance(texto);
            msg.lang = "pt-BR";
            msg.rate = 1.1;
            msg.pitch = 1;
            window.speechSynthesis.speak(msg);
        }
                // Array de mensagens dinâmicas
        const mensagensDinamicas = [
            "Seja bem-vindo ao SolumChat! Tire suas dúvidas sobre física.",
            "Prepare-se para explorar os mistérios da física com o SolumChat!",
            "Olá! Pergunte qualquer coisa sobre física e vamos descobrir juntos.",
            "Curioso sobre o mundo? O SolumChat está pronto para te ajudar!",
            "Entre no mundo da física clássica com o SolumChat!",
            "Mecânica, Termologia, Óptica, Eletromagnetismo, Ondulatória... está com dúvidas nesses temas? Pergunte ao SolumChat!",
            "Quer saber mais sobre físicos famosos e suas descobertas? O SolumChat tem as respostas!",
            "O SolumChat é seu assistente virtual educativo focado em física clássica. Pergunte à vontade!",
            "Física no dia a dia? O SolumChat explica para você!",
        ];

        // Função para exibir uma mensagem aleatória
        function exibirMensagemDinamica() {
            if (tituloDinamico) {
                const indice = Math.floor(Math.random() * mensagensDinamicas.length);
                tituloDinamico.textContent = mensagensDinamicas[indice];
            }
        }

        // Chama a função ao carregar a página
        exibirMensagemDinamica();

        // Botão limpar
        btnLimpar.addEventListener("click", () => chatMensagens.innerHTML = "");

        // Envio de mensagem
        formChat.addEventListener("submit", function(e) {
            e.preventDefault();
            const msg = inputMensagem.value.trim();
            if (!msg) return;

            if (tituloDinamico && !tituloDinamico.classList.contains("hidden")) {
                tituloDinamico.classList.add("hidden");
                setTimeout(() => tituloDinamico.remove(), 900);
            }

            adicionarMensagem(msg, "usuario");

            // Busca resposta
            const resposta = buscarResposta(msg);
            setTimeout(() => {
                adicionarMensagem(resposta, "solum");
                falar(resposta);
            }, 500);

            inputMensagem.value = "";
        });
    </script>
</body>
</html>
